<!DOCTYPE html>
<html>
<head>
<title>Roomies</title>
<head>
    <meta charset='utf-8' />

    <link href='/static/fullcalendar/core/main.css' rel='stylesheet' />
    <link href='/static/fullcalendar/daygrid/main.css' rel='stylesheet' />
    <link href='/static/fullcalendar/timegrid/main.css' rel='stylesheet' />
    <link href='/static/fullcalendar/interaction/main.css' rel='stylesheet' />

    <script src='/static/fullcalendar/core/main.js'></script>
    <script src='/static/fullcalendar/daygrid/main.js'></script>
    <script src='/static/fullcalendar/timeGrid/main.js'></script>
    <script src='/static/fullcalendar/interaction/main.js'></script>
    <script
      src="https://code.jquery.com/jquery-3.4.1.js"
      integrity="sha256-WpOohJOqMqqyKL9FccASB9O0KwACQJpFTUBLTYOVvVU="
      crossorigin="anonymous"></script>

   

</head>
<body>

    {% if session['name'] %}
    <h1>Hello, {{ session['name'] }}</h1>
       <a href="/logout_process">
            <button type="button">Logout!</button>
        </a>
    {% endif %}
    {% block content %}{% endblock %}
     <script>

      document.addEventListener('DOMContentLoaded', function() {
        var calendarEl = document.getElementById('calendar');

        const eventList = $.get('/all_events.json', (res) =>{

        console.log("Event List: " + eventList);
        var calendar = new FullCalendar.Calendar(calendarEl, {
          plugins: [ 'interaction', 'dayGrid', 'timeGrid' ],
          defaultView: 'timeGridWeek',
          defaultDate: '2019-11-11',
          header: {
            left: 'prev,next today',
            center: 'title, addEventButton',
            right: 'dayGridMonth,timeGridWeek,timeGridDay'
          },
          editable: true,
          selectable: true,
          events: res,
        //   events: [
        //   { // this object will be "parsed" into an Event Object
        //     title: 'EVENT!', // a property!
        //     start: '2019-11-12T10:30:00', // a property!
        //     end: '2019-11-12T11:30:00' // a property! ** see important note below about 'end' **
        //   }
        // ],
        dateClick: function(info) {
          alert('clicked ' + info.dateStr);
          let dateStr = info.dateStr;
          let startStr = info.startStr;
          let endStr = info.endString;
          let date = new Date(dateStr + 'T00:00:00'); // will be in local time

        },
        select: function(info) {
          alert('selected ' + info.startStr + ' to ' + info.endStr);
          let dateStr = info.dateStr;
          let startStr = info.startStr;
          let endStr = info.endStr;

          const eventDetails = {
            'start': info.startStr,
            'end': info.endStr
          }

          $.post('/add_event',eventDetails,(response) =>{
            alert(response)
          });

          console.log('startStr' + startStr + 'endStr' + endStr);

          calendar.addEvent({
                    title: 'test event',
                    start: startStr
                    
                  });

        },

          customButtons: {
            addEventButton: {
              text: 'add event...',
              click: function() {
                var dateStr = prompt('Enter a date in YYYY-MM-DD format');
                var date = new Date(dateStr + 'T00:00:00'); // will be in local time
                if (!isNaN(date.valueOf())) { // valid?
                  calendar.addEvent({
                    title: 'dynamic event',
                    start: date,
                    allDay: true
                  });
                  alert('Great. Now, update your database...');
                } else {
                  alert('Invalid date.');
                }
              }
            }
           }
 
         
        });
      

        calendar.render();

      });
   
       });

    </script>
</body>
</html>